<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>

<script>

var originalURL = "https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv";
var queryURL = "https://cors-anywhere.herokuapp.com/" + originalURL;
var data;
$.ajax({
    url: queryURL,
    method: "GET",
    dataType: "text",
    // this headers section is necessary for CORS-anywhere
    headers: {
    "x-requested-with": "xhr" 
    }
    }).done(function(response) {
    console.log('CORS anywhere response');
    //console.log(response);
	successFunction(response);
	//document.write(response);
    }).fail(function(jqXHR, textStatus) { 
    //console.error(textStatus)
}) 

function successFunction(data) {
  var allRows = data.split(/\r?\n|\r/);
  var table = '<table>';
  for (var singleRow = 0; singleRow < allRows.length; singleRow++) {
    if (singleRow === 0) {
      table += '<thead>';
      table += '<tr>';
    } else {
      table += '<tr>';
    }
    var rowCells = allRows[singleRow].split(',');
    for (var rowCell = 0; rowCell < rowCells.length; rowCell++) {
      if (singleRow === 0) {
        table += '<th>';
        table += rowCells[rowCell];
        table += '</th>';
      } else {
        table += '<td>';
        table += rowCells[rowCell];
        table += '</td>';
      }
    }
    if (singleRow === 0) {
      table += '</tr>';
      table += '</thead>';
      table += '<tbody>';
    } else {
      table += '</tr>';
    }
  } 
  table += '</tbody>';
  table += '</table>';
  
  $('body').append(table);
}

</script>
